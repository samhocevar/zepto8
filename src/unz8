function unz8(s,y,x)local w=0local u=0local v local function f(i)u-=i w>>>=i end local function g(i)while u<i do if x and x>0then w+=peek(y)>>>16-u u+=8 y+=1 x-=1 elseif v then w+=v%1<<u u+=12 v=nil else v=0local e=-~0 for i=1,5 do local c=(ord(sub(s,i,i))or 35)-35 v+=e*c e*=49 end s=sub(s,6)w+=v%1<<u u+=16 v>>>=16 end end return(w<<32-i)>>>16-i end local function u(i)return g(i),f(i)end local function v(i)local j=g(i.j)f(i[j]%1*16)return i[j]\1 end local function g(i)local t={j=1}for j=1,288 do t.j=max(t.j,i[j])end local u=0 for l=1,18 do for j=1,288 do if l==i[j]then local z=0 for j=1,l do z+=(u>>>j-1&1)<<l-j end while z<1<<t.j do t[z]=j-1+l/16 z+=1<<l end u+=1 end end u+=u end return(t)end local t={}local w=1local function f(i)local j=w%1local k=w\1t[k]=(i<<>j*32-16)+(t[k]or 0)w+=1/4 end for j=1,288 do if u(1)<1then if u(1)<1then return(t)end for i=1,u(16)do f(u(8))end else local k={}local q={}if u(1)<1then for j=1,288 do k[j]=8 end for j=145,280 do k[j]+=sgn(256-j)end for j=1,32 do q[j]=5 end else local l=257+u(5)local i=1+u(5)local t={}for j=-3,u(4)do t[j%19+1]=u(3)end local g=g(t)local function r(k,l)while#k<l do local g=v(g)if g==16then for j=-2,u(2)do add(k,k[#k])end elseif g==17then for j=-2,u(3)do add(k,0)end elseif g==18then for j=-2,u(7)+8 do add(k,0)end else add(k,g)end end end r(k,l)r(q,i)end k=g(k)q=g(q)local function g(i,j)if i>j then local k=i\j-1i=(i%j+j<<k)+u(k)end return(i)end local i=v(k)while i!=256 do if i<256then f(i)else local l=i<285 and g(i-257,4)or 255local q=1+g(v(q),2)for j=-2,l do local j=(w-q/4)%1local k=(w-q/4)\1 f(t[k]>><j*32-16&255)end end i=v(k)end end end end
